app: sciteco-gtk

ingredients:
  dist: focal
  sources:
    # should always build on the oldest supported version
    - deb http://archive.ubuntu.com/ubuntu/ focal main universe
    - deb http://download.opensuse.org/repositories/home:/rhaberkorn:/sciteco:/UNSTABLE/xUbuntu_20.04/ /
  packages:
    - sciteco-gtk
  exclude:
    # pkg2appimage blacklists Gtk, Pango and other libs from the GNOME stack,
    # so excluding glib as well should actually improve portability.
    - libglib2.0-0
  post_script:
    - dpkg -I sciteco-gtk*.deb | sed -En 's/ *Version: *(.*)/\1/p' >VERSION

script:
  # FIXME: There should perhaps be a unique name in the desktop file, so it does not conflict with the Curses version.
  - mv ./usr/share/applications/sciteco.desktop ./sciteco-gtk.desktop
  - cp ./usr/share/icons/hicolor/256x256/apps/sciteco.png ./sciteco.png
  - rm -rf ./usr/share/icons
  - mkdir -p ./usr/share/metainfo/
  - wget -O ./usr/share/metainfo/sciteco-gtk.appdata.xml -c "https://raw.githubusercontent.com/rhaberkorn/sciteco/master/AppImage/sciteco-gtk.appdata.xml"
  # Thinning: These documentation files are pointless.
  # SciTECO comes with its own online help system.
  - rm -rf ./usr/share/doc ./usr/share/man
